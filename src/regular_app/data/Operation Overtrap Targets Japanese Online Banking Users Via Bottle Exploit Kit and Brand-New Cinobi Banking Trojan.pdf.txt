






































3/12/2020 Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security In…

https://blog.trendmicro.com/trendlabs-security-intelligence/operation-overtrap-targets-japanese-online-banking-users-via-bottle-exploit-kit-and-brand-new-cinob… 1/8

Trend Micro
About TrendLabs Security Intelligence Blog

Search:
 

Go to…

Home
Categories

Home   »   Malware   »   Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New
Cinobi Banking Trojan

Operation Overtrap Targets Japanese Online Banking
Users Via Bottle Exploit Kit and Brand-New Cinobi
Banking Trojan

Posted on:March 11, 2020 at 6:00 am
Posted in:Malware
Author:
Trend Micro

0

By Jaromir Horejsi and Joseph C. Chen (Threat Researchers)

We recently discovered a new campaign that we dubbed “Operation Overtrap” for the numerous ways it can infect or trap
victims with its payload. The campaign mainly targets online users of various Japanese banks by stealing their banking
credentials using a three-pronged attack. Based on our telemetry, Operation Overtrap has been active since April 2019 and has
been solely targeting online banking users located in Japan. Our analysis found that this campaign uses three different attack
vectors to steal its victims’ banking credentials:

By sending spam emails with a phishing link to a page disguised as a banking website
By sending spam emails asking victims to run a disguised malware’s executable downloaded from a linked phishing
page.
By using a custom exploit kit to deliver malware via malvertising

https://www.trendmicro.com/
https://blog.trendmicro.com/trendlabs-security-intelligence/about-us/
https://twitter.com/trendmicrorsrch
http://www.facebook.com/trendmicro
http://www.linkedin.com/company/trend-micro
http://www.youtube.com/user/TrendMicroInc
http://feeds.trendmicro.com/Anti-MalwareBlog
https://blog.trendmicro.com/trendlabs-security-intelligence/
http://blog.trendmicro.com/trendlabs-security-intelligence/
https://blog.trendmicro.com/trendlabs-security-intelligence/
https://blog.trendmicro.com/trendlabs-security-intelligence/category/malware/
https://blog.trendmicro.com/trendlabs-security-intelligence/2020/03/
https://blog.trendmicro.com/trendlabs-security-intelligence/category/malware/
https://blog.trendmicro.com/trendlabs-security-intelligence/author/trend-micro/


3/12/2020 Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security In…

https://blog.trendmicro.com/trendlabs-security-intelligence/operation-overtrap-targets-japanese-online-banking-users-via-bottle-exploit-kit-and-brand-new-cinob… 2/8

Figure 1. Operation Overtrap three-pronged attack flow

This blog will discuss how we discovered the campaign and introduce the brand-new banking trojan Cinobi. Meanwhile, a
detailed look at the different attack vectors associated with this campaign, and a more in-depth analysis of dropped
configuration files as well as Cinobi’s features, are discussed in our technical brief.

Technical Analysis
Discovering Operation Overtrap
We first discovered the campaign in September 2019 using a then-unidentified exploit kit. Based on our data, Operation
Overtrap has been using spam emails to deliver its payload to victims as early as April 2019.

In mid-September, we observed a significant number of victims being redirected to the exploit kit, which targeted Internet
Explorer, after they have clicked on links from social media platforms. It should be noted, however, that the way the victims
received the links has not been identified. It is also worth mentioning that Operation Overtrap only seems to target Japanese
online banking users; it redirects victims with other geolocations to a fake online shop.

Upon analysis, we saw that the exploit kit only dropped a clean binary that does not perform malicious activities on a victim’s
device. It also immediately closes after infection. It is still unclear why the threat actors behind Operation Overtrap initially
delivered a clean binary file; it’s possible that they were testing their custom exploit kit during this stage of the campaign’s
development.

Figure 2. A screengrab that shows exploit kit network traffic in September 2019

https://blog.trendmicro.com/trendlabs-security-intelligence/files/2020/03/FIgure-1-01.png
https://documents.trendmicro.com/assets/pdf/Tech%20Brief_Operation%20Overtrap%20Targets%20Japanese%20Online%20Banking%20Users.pdf
https://blog.trendmicro.com/trendlabs-security-intelligence/files/2020/03/fig2.png


3/12/2020 Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security In…

https://blog.trendmicro.com/trendlabs-security-intelligence/operation-overtrap-targets-japanese-online-banking-users-via-bottle-exploit-kit-and-brand-new-cinob… 3/8

Figure 3. A screengrab that shows a clean file dropped by Operation Overtrap’s exploit kit

Operation Overtrap’s Custom Exploit Kit: Bottle Exploit Kit
On September 29, 2019, we observed that the exploit kit ceased to drop a clean file, and instead, delivered a brand-new
banking trojan that we dubbed “Cinobi.” We also noted that the threat actors behind Operation Overtrap have stopped
redirecting victims from social media and began to use a Japan-targeted malvertising campaign to push their custom exploit
kit.

Another researcher later discovered the custom exploit kit, which was named the Bottle Exploit Kit (BottleEK). It exploits
CVE-2018-15982, a Flash Player use after free vulnerability, as well as CVE-2018-8174, a VBScript remote code execution
vulnerability. Victims will be infected with BottleEK’s payload if they access this particular exploit kit’s landing page with
unpatched or outdated browsers. Our telemetry shows that BottleEK was the most active exploit kit detected in Japan in
February 2020.

Figure 4. Exploit kit activity observed in Japan on February 2020 (Data obtained from Trend Micro Smart Protection
Network™)

Brand-new banking malware: Cinobi
Operation Overtrap used a new banking malware we’ve decided to call Cinobi. Based on our analysis, Cinobi has two versions
— the first one has a DLL library injection payload that compromises victims’ web browsers to perform form-grabbing.

This Cinobi version can also modify web traffic sent to and received from targeted websites. Our investigation found that all
the websites that this campaign targeted were those of Japan-based banks.

Aside from form-grabbing, it also has a webinject function that allows cybercriminals to modify accessed webpages. The
second version has all the capabilities of the first one plus the ability to communicate with a command-and-control (C&C)
server over the Tor proxy.

https://blog.trendmicro.com/trendlabs-security-intelligence/files/2020/03/fig3.png
https://nao-sec.org/2019/12/say-hello-to-bottle-exploit-kit.html
https://nvd.nist.gov/vuln/detail/CVE-2018-15982
https://nvd.nist.gov/vuln/detail/CVE-2018-8174
https://blog.trendmicro.com/trendlabs-security-intelligence/files/2020/03/Figure-4-01.png


3/12/2020 Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security In…

https://blog.trendmicro.com/trendlabs-security-intelligence/operation-overtrap-targets-japanese-online-banking-users-via-bottle-exploit-kit-and-brand-new-cinob… 4/8

Cinobi’s four stages of infection
 Each of Cinobi’s four stages contains an encrypted position-independent shellcode that makes analysis slightly more
complicated. Each stage is downloaded from a C&C server after certain conditions have been met.

First stage

The first stage of Cinobi’s infection chain, which has also been analyzed by another cybersecurity researcher, starts by calling
the “GetUserDefaultUILanguages” function to check if the infected device’s local settings are set to Japanese.

Figure 5. Screengrab of Cinobi’s check to determine the device’s language settings using “GetUserDefaultUILanguages”

Cinobi will then download legitimate unzip.exe and Tor applications from the following locations:

ftp://ftp[.]cadwork.ch/DVD_V20/cadwork.dir/COM/unzip[.]exe
https://archive[.]torproject[.]org/tor-package-archive/torbrowser/8.0.8/tor-win32-0.3.5.8[.]zip

After extracting the Tor archive into the “\AppData\LocalLow\” directory, Cinobi will rename tor.exe to taskhost.exe and
execute it. It will also run tor.exe with custom torrc file settings.

“C:\Users\<username>\AppData\LocalLow\<random_name>\Tor\taskhost.exe” –f
“C:\Users\<username>\AppData\LocalLow\<random_name>\torrc”

It will download the second stage of the malware payload from a .onion C&C address and save it in a randomly named .DLL
file within the “\AppData\LocalLow\” folder. The filename of the first stage downloader is saved into a .JPG file with a random
name.

Figure 6. Screengrab of the .JPG file that contains the filename of the first stage downloader

After this, Cinobi will run the second stage of its downloader on the victim’s machine.

Figure 7. Screengrab of code showing Cinobi running the second stage of its downloader on the victim’s machine

Second stage

Cinobi will connect to its C&C server to download and decrypt the file for the third stage of its infection chain. We observed
that the filename of the third stage starts with the letter C, followed by random characters. Afterward, it will download and
decrypt the file for the fourth stage, which has a filename that starts with the letter A, followed by random characters.

After these, Cinobi will download and decrypt a config file (<random_name>.txt) that contains a new C&C address.

Cinobi uses RC4 encryption with a hardcoded key.

http://www.pwncode.io/2019/12/unpacking-payload-used-in-bottle-ek.html
https://docs.microsoft.com/en-us/windows/win32/api/winnls/nf-winnls-getuserdefaultuilanguage
https://blog.trendmicro.com/trendlabs-security-intelligence/files/2020/03/fig5.png
https://blog.trendmicro.com/trendlabs-security-intelligence/files/2020/03/fig6.png
https://blog.trendmicro.com/trendlabs-security-intelligence/files/2020/03/fig7.png
https://blog.trendmicro.com/trendlabs-security-intelligence/files/2020/03/fig8.png


3/12/2020 Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security In…

https://blog.trendmicro.com/trendlabs-security-intelligence/operation-overtrap-targets-japanese-online-banking-users-via-bottle-exploit-kit-and-brand-new-cinob… 5/8

Figure 8. Screengrab of code showing Cinobi’s decoded config file

Next, Cinobi will run the downloaded third stage infection file using the UAC bypass method via the CMSTPLUA COM
interface.

Third stage

During the third infection stage, Cinobi will copy malware files from “\AppData\LocalLow\” to the “%PUBLIC%” folder. It
will then install the fourth stage of the downloader (which was downloaded during the second stage) as Winsock Layered
Service Provider (WSCInstallProviderAndChains).

Figure 9. Screengrab of code showing the installation of the infection’s fourth stage on the victim machine as
“WSCInstallProviderAndChains”

Cinobi will then perform the following actions:

Change spooler service config to “SERVICE_AUTO_START”
Disable the following services:

UsoSvc
Wuauserv
WaaSMedicSvc
SecurityHealthService
DisableAntiSpyware

Copy and extract Tor files to “%PUBLIC%” folder
Rename tor.exe to taskhost.exe
Create torrc in “%PUBLIC%” with the content “DataDirectory C:\Users\Public\<random_nam>\data\tor”
Create .JPG file with the original dropper name
Remove files from “\AppData\LocalLow\,” remove original dropper file

Fourth stage

Cinobi will call the WSCEnumProtocols function to retrieve information about available transport protocols. It will also call
the WSCGetProviderPath function to retrieve the DLL path of the original transport provider. This function is called twice.
The first call will return the malicious provider (as the fourth stage of the malware has already been installed during the third
stage of infection). The second call will return the original transport provider (“%SystemRoot%\system32\mswsock.dll”) and
resolve and call its WSPStartup function. Cinobi will then check the name of the process in which the malicious DLL provider
gets injected. In practice, Cinobi should be injected into all processes that make network connections using Windows sockets.

Figure 10. Screengrab of processes where the malicious DLL provider has been injected

Best practices against spam and vulnerabilities
Operation Overtrap uses a variety of attack vectors to steal banking credentials. Users and organizations need to adopt best
practices to protect their systems against messaging-related threats and avoid malicious advertisements. An example of a best
practice is to have a central point for reporting suspicious emails. Organizations, through their IT teams, need to have a

https://gist.github.com/api0cradle/d4aaef39db0d845627d819b2b6b30512
https://www.komodia.com/lsp-sub
https://docs.microsoft.com/en-us/windows/win32/api/ws2spi/nf-ws2spi-wscinstallproviderandchains
https://blog.trendmicro.com/trendlabs-security-intelligence/files/2020/03/fig9.png
https://docs.microsoft.com/en-us/windows/win32/api/ws2spi/nf-ws2spi-wscenumprotocols
https://docs.microsoft.com/en-us/windows/win32/api/ws2spi/nf-ws2spi-wscgetproviderpath
https://docs.microsoft.com/en-us/windows/win32/api/ws2spi/nf-ws2spi-wspstartup
https://docs.microsoft.com/en-us/windows/win32/winsock/windows-sockets-start-page-2
https://blog.trendmicro.com/trendlabs-security-intelligence/files/2020/03/fig10.png
https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/infosec-guide-email-threats


3/12/2020 Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security In…

https://blog.trendmicro.com/trendlabs-security-intelligence/operation-overtrap-targets-japanese-online-banking-users-via-bottle-exploit-kit-and-brand-new-cinob… 6/8

centralized information gathering system, and all employees must be aware of the reporting procedure for suspicious emails.
Meanwhile, users can avoid malicious advertisements by avoiding clicking on suspicious links or pop-ups and updating
software via official channels.

Organizations will benefit from regularly updating systems (or use virtual patching for legacy systems) to prevent attackers
from taking advantage of security gaps. Additional security mechanisms like firewalls and intrusion detection and prevention
systems will help thwart suspicious network activities such as data exfiltration or C&C communication.

Trend Micro Solutions
Organizations can consider Trend Micro™ endpoint solutions such as Trend Micro Smart Protection Suites and Worry-Free™
Business Security. Both solutions can protect users and businesses from threats by detecting malicious files and spammed
messages as well as blocking all related malicious URLs. Trend Micro Deep Discovery™ has an email inspection layer that
can protect enterprises by detecting malicious attachments and URLs.

Trend Micro™ Hosted Email Security is a no-maintenance cloud solution that delivers continuously updated protection that
stops spam, malware, spear phishing, ransomware, and advanced targeted attacks before they reach the network. It protects
Microsoft Exchange, Microsoft Office 365, Google Apps, and other hosted and on-premises email solutions.

For defending against malvertising campaigns in general, users can employ Trend Micro™ Maximum Security, which protects
consumers via a multi-layered defense that delivers highly effective and efficient protection against ever-evolving
threats. Trend Micro™ Smart Protection Suites also protect businesses against these types of threats by providing threat
protection techniques designed to eliminate security gaps across multiple users and endpoints.

You may read our in-depth analysis of Operation Overtrap in this technical brief, which also contains details about possible
links to other phishing campaigns and the indicators of compromise.

 

Related Posts:

Latest Trickbot Campaign Delivered via Highly Obfuscated JS File
New Exploit Kit Capesand Reuses Old and New Public Exploits and Tools, Blockchain Ruse

Learn how to protect Enterprises, Small Businesses, and Home Users from ransomware:

ENTERPRISE SMALL BUSINESS HOME

Tags: banking malwarebanking TrojanBottle exploit kitBottleEKCinobiexploit kitOperation Overtrap

» » »

https://www.trendmicro.com/vinfo/us/security/news/security-technology/security-101-virtual-patching
https://www.trendmicro.com/vinfo/us/security/news/security-technology/best-practices-deploying-an-effective-firewall
https://www.trendmicro.com/en_us/business/capabilities/intrusion-prevention.html
https://www.trendmicro.com/en_us/business/products/user-protection/sps.html?utm_campaign=VURL:www.trendmicro.com&utm_medium=VURL&utm_source=/us/enterprise/network-security/interscan-web-security/index.html
https://www.trendmicro.com/en_us/small-business/worry-free.html
https://www.trendmicro.com/en_us/business/products/network/advanced-threat-protection.html
https://www.trendmicro.com/en_us/business/products/user-protection/sps/email-and-collaboration/cloud-email-gateway-services.html
https://www.trendmicro.com/en_us/business/products/user-protection/sps/email-and-collaboration/cloud-app-security.html
https://www.trendmicro.com/en_us/forHome/products/maximum-security.html
https://www.trendmicro.com/en_us/business/products/user-protection/sps.html
https://documents.trendmicro.com/assets/pdf/Tech%20Brief_Operation%20Overtrap%20Targets%20Japanese%20Online%20Banking%20Users.pdf
https://blog.trendmicro.com/trendlabs-security-intelligence/latest-trickbot-campaign-delivered-via-highly-obfuscated-js-file/
https://blog.trendmicro.com/trendlabs-security-intelligence/new-exploit-kit-capesand-reuses-old-and-new-public-exploits-and-tools-blockchain-ruse/
http://www.trendmicro.com/us/security-intelligence/enterprise-ransomware/index.html
http://www.trendmicro.com/us/security-intelligence/small-business-ransomware/index.html
http://www.trendmicro.com/us/home/consumer-ransomware/index.html
https://blog.trendmicro.com/trendlabs-security-intelligence/tag/banking-malware/
https://blog.trendmicro.com/trendlabs-security-intelligence/tag/banking-trojan/
https://blog.trendmicro.com/trendlabs-security-intelligence/tag/bottle-exploit-kit/
https://blog.trendmicro.com/trendlabs-security-intelligence/tag/bottleek/
https://blog.trendmicro.com/trendlabs-security-intelligence/tag/cinobi/
https://blog.trendmicro.com/trendlabs-security-intelligence/tag/exploit-kit/
https://blog.trendmicro.com/trendlabs-security-intelligence/tag/operation-overtrap/


3/12/2020 Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security In…

https://blog.trendmicro.com/trendlabs-security-intelligence/operation-overtrap-targets-japanese-online-banking-users-via-bottle-exploit-kit-and-brand-new-cinob… 7/8

Security Predictions for 2020

Cybersecurity in 2020 will be viewed through many lenses — from differing attacker motivations and cybercriminal
arsenal to technological developments and global threat intelligence — only so defenders can keep up with the broad
range of threats.
Read our security predictions for 2020.

Business Process Compromise

Attackers are starting to invest in long-term operations that target specific processes enterprises rely on. They scout for
vulnerable practices, susceptible systems and operational loopholes that they can leverage or abuse. To learn more, read
our Security 101: Business Process Compromise.

Recent Posts

Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking
Trojan
March Patch Tuesday: LNK, Microsoft Word Vulnerabilities Get Fixes
Busting Ghostcat: An Analysis of the Apache Tomcat Vulnerability (CVE-2020-1938 and CNVD-2020-10487)
Dissecting Geost: Exposing the Anatomy of the Android Trojan Targeting Russian Banks
Security Risks in Online Coding Platforms

Popular Posts

LokiBot Impersonates Popular Game Launcher and Drops Compiled C# Code File

Misconfigured Container Abused to Deliver Cryptocurrency-mining Malware

Dissecting Geost: Exposing the Anatomy of the Android Trojan Targeting Russian Banks

0 Comments TrendLabs 🔒 Privacy Policy Login1

t Tweet f Share Sort by Best

LOG IN WITH OR SIGN UP WITH DISQUS 

Name

Start the discussion…

?

Be the first to comment.

Subscribe✉ Add Disqus to your siteAdd DisqusAddd
D N t S ll M D t⚠

 Recommend

https://www.trendmicro.com/vinfo/us/security/research-and-analysis/predictions/2020
https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/security-101-business-process-compromise
https://blog.trendmicro.com/trendlabs-security-intelligence/operation-overtrap-targets-japanese-online-banking-users-via-bottle-exploit-kit-and-brand-new-cinobi-banking-trojan/
https://blog.trendmicro.com/trendlabs-security-intelligence/march-patch-tuesday-lnk-microsoft-word-vulnerabilities-get-fixes/
https://blog.trendmicro.com/trendlabs-security-intelligence/busting-ghostcat-an-analysis-of-the-apache-tomcat-vulnerability-cve-2020-1938-and-cnvd-2020-10487/
https://blog.trendmicro.com/trendlabs-security-intelligence/dissecting-geost-exposing-the-anatomy-of-the-android-trojan-targeting-russian-banks/
https://blog.trendmicro.com/trendlabs-security-intelligence/security-risks-in-online-coding-platforms/
https://blog.trendmicro.com/trendlabs-security-intelligence/lokibot-impersonates-popular-game-launcher-and-drops-compiled-c-code-file/
https://blog.trendmicro.com/trendlabs-security-intelligence/misconfigured-container-abused-to-deliver-cryptocurrency-mining-malware/
https://blog.trendmicro.com/trendlabs-security-intelligence/dissecting-geost-exposing-the-anatomy-of-the-android-trojan-targeting-russian-banks/
https://disqus.com/
https://disqus.com/home/forums/trendlabs/
https://help.disqus.com/customer/portal/articles/466259-privacy-policy
https://disqus.com/home/inbox/
https://publishers.disqus.com/engage?utm_source=trendlabs&utm_medium=Disqus-Footer
https://disqus.com/data-sharing-settings/


3/12/2020 Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security In…

https://blog.trendmicro.com/trendlabs-security-intelligence/operation-overtrap-targets-japanese-online-banking-users-via-bottle-exploit-kit-and-brand-new-cinob… 8/8

February Patch Tuesday: Fixes for Critical LNK, RDP, Trident Vulnerabilities

Angler and Nuclear Exploit Kits Integrate Pawn Storm Flash Exploit

Stay Updated

Email Subscription
Your email here

Subscribe

Home and Home Office
|
For Business
|
Security Intelligence
|
About Trend Micro

Asia Pacific Region (APAC): Australia / New Zealand, 中国, ⽇本, 대한민국, 台灣
Latin America Region (LAR): Brasil, México
North America Region (NABU): United States, Canada 
Europe, Middle East, & Africa Region (EMEA): France, Deutschland / Österreich / Schweiz, Italia, Россия, España,
United Kingdom / Ireland

Privacy Statement
Legal Policies

Copyright © 2020 Trend Micro Incorporated. All rights reserved.

https://blog.trendmicro.com/trendlabs-security-intelligence/february-patch-tuesday-fixes-for-critical-lnk-rdp-trident-vulnerabilities/
https://blog.trendmicro.com/trendlabs-security-intelligence/angler-and-nuclear-exploit-kits-integrate-pawn-storm-flash-exploit/
http://www.trendmicro.com/us/home/index.html
http://www.trendmicro.com/us/business/index.html
http://www.trendmicro.com/us/security-intelligence/index.html
http://www.trendmicro.com/us/about-us/index.html
http://www.trendmicro.com.au/au/home/index.html
http://www.trendmicro.co.nz/nz/home/index.html
http://cn.trendmicro.com/cn/home/index.html
http://jp.trendmicro.com/jp/home/index.html
http://www.trendmicro.co.kr/index.html
http://tw.trendmicro.com/tw/home/index.html
http://br.trendmicro.com/br/home/index.html
http://la.trendmicro.com/la/home/index.html
http://www.trendmicro.com/us/index.html
http://ca.trendmicro.com/ca/home/index.html
http://www.trendmicro.fr/
http://www.trendmicro.de/
http://www.trendmicro.it/
http://www.trendmicro.com.ru/
http://www.trendmicro.es/
http://www.trendmicro.co.uk/
http://www.trendmicro.com/us/about-us/legal-policies/privacy-statement/index.html
http://www.trendmicro.com/us/about-us/legal-policies/index.html

